// Tests pipeline status objects that capture per-stage failures.

const ensure = import("test_support/ensure").ensure

const healthy = (true | true)
ensure(healthy.status.ok, "all stages succeed")

const first_failure = (false | true)
const first_status = first_failure.status
ensure(!first_status.ok, "pipeline flagged failure")
ensure(first_status.failed_stage == 0, "records first stage failure index")

const second_failure = (true | false)
const second_status = second_failure.status
ensure(!second_status.ok, "second pipeline flagged failure")
ensure(second_status.failed_stage == 1, "records downstream failure index")

echo "error-aware pipeline test passed"
